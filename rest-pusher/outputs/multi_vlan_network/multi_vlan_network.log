---- mininet

student@ubuntu:~$ sudo mn --custom /home/student/Desktop/configs_outputs/multi_vlan_network.py --mac --controller 'remote,ip="127.0.0.1",port=6633' --switch ovsk,protocols=OpenFlow13
--------------------------------------------------------------------------------
Caught exception. Cleaning up...

ImportError: No module named apt
--------------------------------------------------------------------------------
student@ubuntu:~$ sudo apt-get install vlan
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following packages were automatically installed and are no longer required:
  linux-headers-4.15.0-29 linux-headers-4.15.0-29-generic linux-image-4.15.0-29-generic linux-modules-4.15.0-29-generic linux-modules-extra-4.15.0-29-generic
Use 'sudo apt autoremove' to remove them.
The following NEW packages will be installed:
  vlan
0 upgraded, 1 newly installed, 0 to remove and 101 not upgraded.
Need to get 30.7 kB of archives.
After this operation, 122 kB of additional disk space will be used.
Get:1 http://us.archive.ubuntu.com/ubuntu bionic-updates/main amd64 vlan amd64 1.9-3.2ubuntu6 [30.7 kB]
Fetched 30.7 kB in 0s (68.4 kB/s)
Selecting previously unselected package vlan.
(Reading database ... 222276 files and directories currently installed.)
Preparing to unpack .../vlan_1.9-3.2ubuntu6_amd64.deb ...
Unpacking vlan (1.9-3.2ubuntu6) ...
Setting up vlan (1.9-3.2ubuntu6) ...
Processing triggers for man-db (2.8.3-2) ...
student@ubuntu:~$ sudo mn --custom /home/student/Desktop/configs_outputs/multi_vlan_network.py --mac --controller 'remote,ip="127.0.0.1",port=6633' --switch ovsk,protocols=OpenFlow13
--------------------------------------------------------------------------------
Caught exception. Cleaning up...

ImportError: No module named apt
--------------------------------------------------------------------------------
student@ubuntu:~$ sudo mn --custom /home/student/Desktop/configs_outputs/multi_vlan_network.py --mac --controller 'remote,ip="127.0.0.1",port=6633' --switch ovsk,protocols=OpenFlow13
*** Creating network
*** Adding controller
*** Adding hosts:
h1 h2 
*** Adding switches:
s1 
*** Adding links:
(h1, s1) (h2, s1) 
*** Configuring hosts
h1 h2 
*** Starting controller
c0 
*** Starting 1 switches
s1 ...
*** Starting CLI:
mininet> net
h1 h1-eth0:s1-eth1
h2 h2-eth0:s1-eth2
s1 lo:  s1-eth1:h1-eth0 s1-eth2:h2-eth0
c0
mininet> 
*** Stopping 1 controllers
c0 
*** Stopping 2 links
..
*** Stopping 1 switches
s1 
*** Stopping 2 hosts
h1 h2 
*** Done
completed in 29.477 seconds
student@ubuntu:~$ sudo mn --custom /home/student/Desktop/configs_outputs/multi_vlan_network.py --topo mytopo --mac --controller 'remote,ip="127.0.0.1",port=6633' --switch ovsk,protocols=OpenFlow13
*** Creating network
*** Adding controller
*** Adding hosts:
h1 h2 h3 h4 h5 h6 
*** Adding switches:
s1 s2 s3 
*** Adding links:
(s1, h1) (s1, s2) (s1, s3) (s2, h2) (s2, h3) (s2, h4) (s3, h5) (s3, h6) 
*** Configuring hosts
h1 h2 h3 h4 h5 h6 
*** Starting controller
c0 
*** Starting 3 switches
s1 s2 s3 ...
*** Starting CLI:
mininet> net
h1 h1-eth0.200:s1-eth1
h2 h2-eth0.300:s2-eth2
h3 h3-eth0.200:s2-eth3
h4 h4-eth0.300:s2-eth4
h5 h5-eth0.200:s3-eth2
h6 h6-eth0.300:s3-eth3
s1 lo:  s1-eth1:h1-eth0.200 s1-eth2:s2-eth1 s1-eth3:s3-eth1
s2 lo:  s2-eth1:s1-eth2 s2-eth2:h2-eth0.300 s2-eth3:h3-eth0.200 s2-eth4:h4-eth0.300
s3 lo:  s3-eth1:s1-eth3 s3-eth2:h5-eth0.200 s3-eth3:h6-eth0.300
c0
mininet> pingall
*** Ping: testing ping reachability
h1 -> X h3 X h5 X 
h2 -> X X h4 X h6 
h3 -> h1 X X h5 X 
h4 -> X h2 X X h6 
h5 -> h1 X h3 X X 
h6 -> X h2 X h4 X 
*** Results: 60% dropped (12/30 received)
mininet> pingall
*** Ping: testing ping reachability
h1 -> X h3 X h5 X 
h2 -> X X h4 X h6 
h3 -> h1 X X h5 X 
h4 -> X h2 X --------------------------------------------------------------------------------
Caught exception. Cleaning up...

OSError: [Errno 4] Interrupted system call
--------------------------------------------------------------------------------
*** Removing excess controllers/ofprotocols/ofdatapaths/pings/noxes
killall controller ofprotocol ofdatapath ping nox_corelt-nox_core ovs-openflowd ovs-controllerovs-testcontroller udpbwtest mnexec ivs ryu-manager 2> /dev/null
killall -9 controller ofprotocol ofdatapath ping nox_corelt-nox_core ovs-openflowd ovs-controllerovs-testcontroller udpbwtest mnexec ivs ryu-manager 2> /dev/null
pkill -9 -f "sudo mnexec"
*** Removing junk from /tmp
rm -f /tmp/vconn* /tmp/vlogs* /tmp/*.out /tmp/*.log
*** Removing old X11 tunnels
*** Removing excess kernel datapaths
ps ax | egrep -o 'dp[0-9]+' | sed 's/dp/nl:/'
***  Removing OVS datapaths
ovs-vsctl --timeout=1 list-br
ovs-vsctl --if-exists del-br s1 -- --if-exists del-br s2 -- --if-exists del-br s3
ovs-vsctl --timeout=1 list-br
*** Removing all links of the pattern foo-ethX
ip link show | egrep -o '([-_.[:alnum:]]+-eth[[:digit:]]+)'
( ip link del s1-eth1;ip link del s2-eth1;ip link del s1-eth2;ip link del s1-eth2;ip link del s2-eth1;ip link del s3-eth1;ip link del s1-eth3;ip link del s1-eth3;ip link del s3-eth1;ip link del s2-eth2;ip link del s2-eth3;ip link del s2-eth4;ip link del s3-eth2;ip link del s3-eth3 ) 2> /dev/null
ip link show
*** Killing stale mininet node processes
pkill -9 -f mininet:
*** Shutting down stale tunnels
pkill -9 -f Tunnel=Ethernet
pkill -9 -f .ssh/mn
rm -f ~/.ssh/mn/*
*** Cleanup complete.
student@ubuntu:~$ sudo mn --clear
[sudo] password for student: 
Usage: mn [options]
(type mn -h for details)

mn: error: no such option: --clear
student@ubuntu:~$ sudo mn --clean
*** Removing excess controllers/ofprotocols/ofdatapaths/pings/noxes
killall controller ofprotocol ofdatapath ping nox_corelt-nox_core ovs-openflowd ovs-controllerovs-testcontroller udpbwtest mnexec ivs ryu-manager 2> /dev/null
killall -9 controller ofprotocol ofdatapath ping nox_corelt-nox_core ovs-openflowd ovs-controllerovs-testcontroller udpbwtest mnexec ivs ryu-manager 2> /dev/null
pkill -9 -f "sudo mnexec"
*** Removing junk from /tmp
rm -f /tmp/vconn* /tmp/vlogs* /tmp/*.out /tmp/*.log
*** Removing old X11 tunnels
*** Removing excess kernel datapaths
ps ax | egrep -o 'dp[0-9]+' | sed 's/dp/nl:/'
***  Removing OVS datapaths
ovs-vsctl --timeout=1 list-br
ovs-vsctl --timeout=1 list-br
*** Removing all links of the pattern foo-ethX
ip link show | egrep -o '([-_.[:alnum:]]+-eth[[:digit:]]+)'
ip link show
*** Killing stale mininet node processes
pkill -9 -f mininet:
*** Shutting down stale tunnels
pkill -9 -f Tunnel=Ethernet
pkill -9 -f .ssh/mn
rm -f ~/.ssh/mn/*
*** Cleanup complete.
student@ubuntu:~$ sudo mn --custom /home/student/Desktop/configs_outputs/multi_vlan_network.py --topo mytopo --mac --controller 'remote,ip="127.0.0.1",port=6633' --switch ovsk,protocols=OpenFlow13
*** Creating network
*** Adding controller
*** Adding hosts:
h1 h2 h3 h4 h5 h6 
*** Adding switches:
s1 s2 s3 
*** Adding links:
(s1, h1) (s1, s2) (s1, s3) (s2, h2) (s2, h3) (s2, h4) (s3, h5) (s3, h6) 
*** Configuring hosts
h1 h2 h3 h4 h5 h6 
*** Starting controller
c0 
*** Starting 3 switches
s1 s2 s3 ...
*** Starting CLI:
mininet> 
mininet> pingall
*** Ping: testing ping reachability
h1 -> X h3 X h5 X 
h2 -> X X h4 X h6 
h3 -> h1 X X h5 X 
h4 -> X h2 X X h6 
h5 -> h1 X h3 X X 
h6 -> X h2 X h4 X 
*** Results: 60% dropped (12/30 received)
mininet> h1 ping h3
PING 10.0.0.3 (10.0.0.3) 56(84) bytes of data.
64 bytes from 10.0.0.3: icmp_seq=1 ttl=64 time=0.671 ms
64 bytes from 10.0.0.3: icmp_seq=1 ttl=64 time=4.79 ms (DUP!)
64 bytes from 10.0.0.3: icmp_seq=1 ttl=64 time=10.6 ms (DUP!)
64 bytes from 10.0.0.3: icmp_seq=1 ttl=64 time=19.0 ms (DUP!)
64 bytes from 10.0.0.3: icmp_seq=2 ttl=64 time=0.234 ms
64 bytes from 10.0.0.3: icmp_seq=3 ttl=64 time=0.052 ms
64 bytes from 10.0.0.3: icmp_seq=4 ttl=64 time=0.054 ms
^C
--- 10.0.0.3 ping statistics ---
4 packets transmitted, 4 received, +3 duplicates, 0% packet loss, time 3028ms
rtt min/avg/max/mdev = 0.052/5.079/19.058/6.765 ms
mininet> h1 ping h3
PING 10.0.0.3 (10.0.0.3) 56(84) bytes of data.
64 bytes from 10.0.0.3: icmp_seq=1 ttl=64 time=0.051 ms
64 bytes from 10.0.0.3: icmp_seq=2 ttl=64 time=0.084 ms
64 bytes from 10.0.0.3: icmp_seq=3 ttl=64 time=0.063 ms
64 bytes from 10.0.0.3: icmp_seq=4 ttl=64 time=0.065 ms
64 bytes from 10.0.0.3: icmp_seq=5 ttl=64 time=0.069 ms
^C
--- 10.0.0.3 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4084ms
rtt min/avg/max/mdev = 0.051/0.066/0.084/0.012 ms
mininet> h1 ping h2
PING 10.0.0.2 (10.0.0.2) 56(84) bytes of data.
From 10.0.0.1 icmp_seq=1 Destination Host Unreachable
From 10.0.0.1 icmp_seq=2 Destination Host Unreachable
From 10.0.0.1 icmp_seq=3 Destination Host Unreachable
^C
--- 10.0.0.2 ping statistics ---
5 packets transmitted, 0 received, +3 errors, 100% packet loss, time 4073ms
pipe 4
mininet> 


--- ubuntu console

student@ubuntu:~$ curl --user "admin":"admin" -H "Content-type: application/json" -X POST http://localhost:8181/restconf/operations/vtn:update-vtn -d '{"input":{"tenant-name":"VTN_multi_vlan"}}'
{"output":{"status":"CREATED"}}student@ubuntu:~$ 
student@ubuntu:~$ curl --user "admin":"admin" -H "Content-type: application/json" -X POST http://localhost:8181/restconf/operations/vtn-vbridge:update-vbridge -d '{"input":{"tenant-name":"VTN_multi_vlan","bridge-name":"VirtBr1"}}'
{"output":{"status":"CREATED"}}student@ubuntu:~$ 
student@ubuntu:~$ curl --user "admin":"admin" -H "Content-type: application/json" -X POST http://localhost:8181/restconf/operations/vtn-vlan-map:add-vlan-map -d '{"input":{"vlan-id":200,"tenant-name":"VTN_multi_vlan","bridge-name":"VirtBr1"}}'
{"output":{"map-id":"ANY.200","active":true}}student@ubuntu:~$ 
student@ubuntu:~$ curl --user "admin":"admin" -H "Content-type: application/json" -X POST http://localhost:8181/restconf/operations/vtn-vbridge:update-vbridge -d '{"input":{"tenant-name":"VTN_multi_vlan","bridge-name":"VirtBr2"}}'
{"output":{"status":"CREATED"}}student@ubuntu:~$ 
student@ubuntu:~$ curl --user "admin":"admin" -H "Content-type: application/json" -X POST http://localhost:8181/restconf/operations/vtn-vlan-map:add-vlan-map -d '{"input":{"vlan-id":300,"tenant-name":"VTN_multi_vlan","bridge-name":"VirtBr2"}}'
{"output":{"map-id":"ANY.300","active":true}}student@ubuntu:~$ 
student@ubuntu:~$ curl --user "admin":"admin" -H "Content-type: application/json" -X GET http://localhost:8181/restconf/operational/vtn:vtns
{"vtns":{"vtn":[{"name":"VTN_test","vtenant-config":{"hard-timeout":0,"idle-timeout":300},"vbridge":[{"name":"VirtBr1","bridge-status":{"state":"DOWN","path-faults":0},"vbridge-config":{"age-interval":600},"vinterface":[{"name":"int2","vinterface-config":{"enabled":true},"vinterface-status":{"state":"DOWN","entity-state":"UNKNOWN"},"port-map-config":{"node":"openflow:7","port-name":"s7-eth1","vlan-id":0}},{"name":"int1","vinterface-config":{"enabled":true},"vinterface-status":{"state":"DOWN","mapped-port":"openflow:3:1","entity-state":"UP"},"port-map-config":{"node":"openflow:3","port-name":"s3-eth1","vlan-id":0}}]}]},{"name":"VTN_multi_vlan","vtenant-config":{"hard-timeout":0,"idle-timeout":300},"vbridge":[{"name":"VirtBr1","bridge-status":{"state":"UP","path-faults":0},"vbridge-config":{"age-interval":600},"vlan-map":[{"map-id":"ANY.200","vlan-map-status":{"active":true},"vlan-map-config":{"vlan-id":200}}]},{"name":"VirtBr2","bridge-status":{"state":"UP","path-faults":0},"vbridge-config":{"age-interval":600},"vlan-map":[{"map-id":"ANY.300","vlan-map-status":{"active":true},"vlan-map-config":{"vlan-id":300}}]}]}]}}

---- switch tables

---- before
root@ubuntu:~# ovs-ofctl -O OpenFlow13 dump-flows s3
 cookie=0x2b00000000000008, duration=171.414s, table=0, n_packets=36, n_bytes=3060, priority=100,dl_type=0x88cc actions=CONTROLLER:65535
 cookie=0x2a00000000000062, duration=163.143s, table=0, n_packets=4, n_bytes=240, idle_timeout=600, hard_timeout=300, priority=10,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:05 actions=output:"s3-eth2"
 cookie=0x2a00000000000063, duration=163.143s, table=0, n_packets=4, n_bytes=240, idle_timeout=600, hard_timeout=300, priority=10,dl_src=00:00:00:00:00:05,dl_dst=00:00:00:00:00:01 actions=output:"s3-eth1"
 cookie=0x2a00000000000068, duration=150.845s, table=0, n_packets=3, n_bytes=194, idle_timeout=600, hard_timeout=300, priority=10,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:06 actions=output:"s3-eth3"
 cookie=0x2a00000000000069, duration=150.845s, table=0, n_packets=3, n_bytes=194, idle_timeout=600, hard_timeout=300, priority=10,dl_src=00:00:00:00:00:06,dl_dst=00:00:00:00:00:02 actions=output:"s3-eth1"
 cookie=0x2a00000000000070, duration=144.712s, table=0, n_packets=2, n_bytes=148, idle_timeout=600, hard_timeout=300, priority=10,dl_src=00:00:00:00:00:03,dl_dst=00:00:00:00:00:05 actions=output:"s3-eth2"
 cookie=0x2a00000000000071, duration=144.712s, table=0, n_packets=2, n_bytes=148, idle_timeout=600, hard_timeout=300, priority=10,dl_src=00:00:00:00:00:05,dl_dst=00:00:00:00:00:03 actions=output:"s3-eth1"
 cookie=0x2a00000000000074, duration=132.422s, table=0, n_packets=2, n_bytes=148, idle_timeout=600, hard_timeout=300, priority=10,dl_src=00:00:00:00:00:04,dl_dst=00:00:00:00:00:06 actions=output:"s3-eth3"
 cookie=0x2a00000000000075, duration=132.422s, table=0, n_packets=2, n_bytes=148, idle_timeout=600, hard_timeout=300, priority=10,dl_src=00:00:00:00:00:06,dl_dst=00:00:00:00:00:04 actions=output:"s3-eth1"
 cookie=0x2b0000000000001d, duration=167.425s, table=0, n_packets=114, n_bytes=8012, priority=2,in_port="s3-eth1" actions=output:"s3-eth2",output:"s3-eth3",CONTROLLER:65535
 cookie=0x2b0000000000001e, duration=167.425s, table=0, n_packets=23, n_bytes=1430, priority=2,in_port="s3-eth2" actions=output:"s3-eth1",output:"s3-eth3",CONTROLLER:65535
 cookie=0x2b0000000000001f, duration=167.425s, table=0, n_packets=23, n_bytes=1430, priority=2,in_port="s3-eth3" actions=output:"s3-eth1",output:"s3-eth2",CONTROLLER:65535
 cookie=0x7f57ffffffffffff, duration=171.346s, table=0, n_packets=34, n_bytes=3648, send_flow_rem priority=0 actions=CONTROLLER:65535

--- after

root@ubuntu:~# ovs-ofctl -O OpenFlow13 dump-flows s3
 cookie=0x2b00000000000008, duration=553.527s, table=0, n_packets=112, n_bytes=9520, priority=100,dl_type=0x88cc actions=CONTROLLER:65535
 cookie=0x7f5600000000001a, duration=52.032s, table=0, n_packets=3, n_bytes=194, send_flow_rem priority=10,in_port="s3-eth1",dl_vlan=200,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:05 actions=output:"s3-eth2"
 cookie=0x7f5600000000001b, duration=52.005s, table=0, n_packets=3, n_bytes=194, idle_timeout=300, send_flow_rem priority=10,in_port="s3-eth2",dl_vlan=200,dl_src=00:00:00:00:00:05,dl_dst=00:00:00:00:00:01 actions=output:"s3-eth1"
 cookie=0x7f5600000000001f, duration=39.745s, table=0, n_packets=5, n_bytes=286, send_flow_rem priority=10,in_port="s3-eth1",dl_vlan=300,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:06 actions=output:"s3-eth3"
 cookie=0x7f56000000000020, duration=39.738s, table=0, n_packets=5, n_bytes=286, idle_timeout=300, send_flow_rem priority=10,in_port="s3-eth3",dl_vlan=300,dl_src=00:00:00:00:00:06,dl_dst=00:00:00:00:00:02 actions=output:"s3-eth1"
 cookie=0x7f56000000000021, duration=33.599s, table=0, n_packets=4, n_bytes=296, idle_timeout=300, send_flow_rem priority=10,in_port="s3-eth2",dl_vlan=200,dl_src=00:00:00:00:00:05,dl_dst=00:00:00:00:00:03 actions=output:"s3-eth1"
 cookie=0x7f56000000000022, duration=33.597s, table=0, n_packets=3, n_bytes=194, send_flow_rem priority=10,in_port="s3-eth1",dl_vlan=200,dl_src=00:00:00:00:00:03,dl_dst=00:00:00:00:00:05 actions=output:"s3-eth2"
 cookie=0x7f56000000000023, duration=21.295s, table=0, n_packets=3, n_bytes=194, idle_timeout=300, send_flow_rem priority=10,in_port="s3-eth3",dl_vlan=300,dl_src=00:00:00:00:00:06,dl_dst=00:00:00:00:00:04 actions=output:"s3-eth1"
 cookie=0x7f56000000000024, duration=21.290s, table=0, n_packets=3, n_bytes=194, send_flow_rem priority=10,in_port="s3-eth1",dl_vlan=300,dl_src=00:00:00:00:00:04,dl_dst=00:00:00:00:00:06 actions=output:"s3-eth3"
 cookie=0x2b0000000000001d, duration=549.538s, table=0, n_packets=184, n_bytes=12396, priority=2,in_port="s3-eth1" actions=output:"s3-eth2",output:"s3-eth3",CONTROLLER:65535
 cookie=0x2b0000000000001e, duration=549.538s, table=0, n_packets=40, n_bytes=2456, priority=2,in_port="s3-eth2" actions=output:"s3-eth1",output:"s3-eth3",CONTROLLER:65535
 cookie=0x2b0000000000001f, duration=549.538s, table=0, n_packets=42, n_bytes=2632, priority=2,in_port="s3-eth3" actions=output:"s3-eth1",output:"s3-eth2",CONTROLLER:65535
 cookie=0x7f57ffffffffffff, duration=553.459s, table=0, n_packets=34, n_bytes=3648, send_flow_rem priority=0 actions=CONTROLLER:65535
